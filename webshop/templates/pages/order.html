{#{% extends "templates/web.html" %}
{% from "webshop/templates/includes/order/order_macros.html" import item_name_and_description %}
{% from "templates/includes/macros.html" import product_image %}

{% block breadcrumbs %}
	{% include "templates/includes/breadcrumbs.html" %}
{% endblock %}

{% block title %}
	{{ doc.name }}
{% endblock %}

{% block header %}
 <style>
  .product-banner {
    background: linear-gradient(90deg, #570987, #2d2c2c);
    color: #ffffff;
    padding: 4rem 0;
}
.breadcrumb_a a {
    font-size: 1rem;
    color: #ffffff;
    font-weight: 700;
    text-decoration: none;
     /*opacity: 0.8; */
    transition: opacity 0.3s ease;
}
 
.breadcrumb_a span {
    margin: 0 9px;
    color: #ffffff;
}
 
.product-banner-title {
    font-size: 3rem;
    font-weight: 700;
    margin: 0;
    border-top: 1px solid rgba(255, 255, 255, 0.4);
    padding-top: 2rem;
}
</style>
<section class="product-banner mb-5">
<div class="container-fluid">
  <nav class="breadcrumb_a">
<a href="/">Home</a> <span>/</span> <a href="/all-products">All Products</a><span>/</span> <a href="/orders">Orders</a><span>/</span> <a href="">{{ doc.name }}</a>
</nav>
<h1 class="product-banner-title">{{ doc.name }}</h1>
</div>
</section>
{% endblock %}


{% block page_content %}
	<div class="container pb-6">
		 <div class="card shadow-sm mb-4">
    <div class="card-body row align-items-center">
      <div class="col-md-6 mb-2">
        <div class="badge bg-info text-light p-2 px-3 text-uppercase me-2">
          {{ _(doc.get('indicator_title')) or _(doc.status) or _("Submitted") }}
        </div>
        <div class="text-muted mt-2 small">
          {{ frappe.utils.format_date(doc.transaction_date, "medium") }}
          {% if doc.valid_till %}
            • {{ _("Valid Till") }}: {{ frappe.utils.format_date(doc.valid_till, "medium") }}
          {% endif %}
        </div>
      </div>
      <div class="col-md-6 text-end">
        <h5 class="mb-0">
          {%- set party_name = doc.supplier_name if doc.doctype in ['Supplier Quotation', 'Purchase Invoice', 'Purchase Order'] else doc.customer_name -%}
          {{ party_name }}
        </h5>
        {% if doc.contact_display and doc.contact_display != party_name %}
        <div class="text-muted small">{{ doc.contact_display }}</div>
        {% endif %}
        {% if enabled_checkout and (doc.doctype != "Sales Invoice" or doc.outstanding_amount > 0) %}
          <a href="/api/method/erpnext.accounts.doctype.payment_request.payment_request.make_payment_request?dn={{ doc.name }}&dt={{ doc.doctype }}&submit_doc=1&order_type=Shopping Cart" class="btn btn-sm btn-success mt-2">
            {{ _("Pay") }} {{ doc.get_formatted("grand_total") }}
          </a>
        {% endif %}
      </div>
    </div>
  </div>

		{% if doc._header %}
			{{ doc._header }}
		{% endif %}
  		
  		<style>
			.order-item-row:hover {
				background-color: #f9f9f9;
			}
			.order-image img {
				max-width: 60px;
				max-height: 60px;
				object-fit: cover;
				border-radius: 4px;
			}

		</style>
		<div class="order-container mt-4">
			<div class="card shadow-sm">
				<div class="card-header bg-light text-muted font-weight-bold">
					<div class="row">
						<div class="col-md-5">{{ _("Item") }}</div>
						<div class="col-md-3">{{ _("Quantity") }}</div>
						<div class="col-md-2">{{ _("Rate") }}</div>
						<div class="col-md-2 text-right">{{ _("Amount") }}</div>
					</div>
				</div>
				<div class="card-body p-0">
					{% for d in doc.items %}
					<div class="row align-items-center py-3 px-3 border-bottom order-item-row">
						<div class="col-md-5">
							<div class="d-flex align-items-start">
								<div class="order-image mr-2">
									{% set website_item_list = frappe.get_all("Website Item", filters={"item_code": d.item_code}, limit=1) %}
									{% if website_item_list %}
										{% set website_item = frappe.get_doc("Website Item", website_item_list[0].name) %}
										{% if website_item.website_image %}
											{{ product_image(website_item.website_image, no_border=True) }}
										{% endif %}
									{% else %}
										<div class="no-image-cart-item bg-secondary text-white text-center rounded" style="width: 60px; height: 60px;">
											{{ frappe.utils.get_abbr(d.item_name) or "NA" }}
										</div>
									{% endif %}
								</div>
								<div>
									<strong>{{ d.item_code }}</strong>
									<div class="text-muted small">
										{{ html2text(d.description or "") | truncate(100) }}
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-3">{{ d.get_formatted("qty") }}</div>
						<div class="col-md-2">{{ d.get_formatted("rate") }}</div>
						<div class="col-md-2 text-right font-weight-bold">{{ d.get_formatted("amount") }}</div>
					</div>
					{% endfor %}
				</div>
			</div>
		</div>


			<!-- taxes -->
			<div class="">
				{% include "webshop/templates/includes/order/order_taxes.html" %}
			</div>
		</div>
	</div>

	{% if enabled_checkout and ((doc.doctype=="Sales Order" and doc.per_billed <= 0)
		or (doc.doctype=="Sales Invoice" and doc.outstanding_amount> 0)) %}
		<div class="panel panel-default">
			<div class="panel-collapse">
				<div class="panel-body text-muted small">
					<div class="row">
						<div class="form-column col-sm-6">
							{% if available_loyalty_points %}
							<div class="panel-heading">
								<div class="row">
									<div class="form-column col-sm-6 address-title">
										<strong>Loyalty Points</strong>
									</div>
								</div>
							</div>

							<div class="form-group">
								<div class="h6">Enter Loyalty Points</div>
								<div class="control-input-wrapper">
									<div class="control-input">
										<input class="form-control" type="number" min="0"
											max="{{ available_loyalty_points }}" id="loyalty-point-to-redeem">
									</div>
									<p class="help-box small text-muted d-none d-sm-block"> Available Points: {{
										available_loyalty_points }} </p>
								</div>
							</div>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>
	{% endif %}


	{% if attachments %}
		<div class="order-item-table">
			<div class="row order-items order-item-header text-muted">
				<div class="col-sm-12 h6 text-uppercase">
					{{ _("Attachments") }}
				</div>
			</div>
			<div class="row order-items">
				<div class="col-sm-12">
					{% for attachment in attachments %}
					<p class="small">
						<a href="{{ attachment.file_url }}" target="blank"> {{ attachment.file_name }} </a>
					</p>
					{% endfor %}
				</div>
			</div>
		</div>
	{% endif %}

	{% if doc.terms %}
		<div class="terms-and-condition text-muted small">
			<hr>
			<p>{{ doc.terms }}</p>
		</div>
	{% endif %}
{% endblock %}#}

{% extends "templates/web.html" %}
{% from "webshop/templates/includes/order/order_macros.html" import item_name_and_description %}
{% from "templates/includes/macros.html" import product_image %}

{% block breadcrumbs %}
    {% include "templates/includes/breadcrumbs.html" %}
{% endblock %}

{% block title %}
    {{ doc.name }}
{% endblock %}

{% block header %}
<style>
/* Banner */
.product-banner {
    background: linear-gradient(90deg, #570987, #2d2c2c);
    color: #ffffff;
    padding: 4rem 0;
}
.breadcrumb_a a {
    font-size: 1rem;
    color: #ffffff;
    font-weight: 700;
    text-decoration: none;
    transition: opacity 0.3s ease;
}
.breadcrumb_a span {
    margin: 0 9px;
    color: #ffffff;
}
.product-banner-title {
    font-size: 3rem;
    font-weight: 700;
    margin: 0;
    border-top: 1px solid rgba(255, 255, 255, 0.4);
    padding-top: 2rem;
}
</style>
<section class="product-banner mb-5">
    <div class="container-fluid">
        <nav class="breadcrumb_a">
            <a href="/">Home</a> <span>/</span> 
            <a href="/all-products">All Products</a> <span>/</span> 
            <a href="/orders">Orders</a><span>/</span> 
            <a href="">{{ doc.name }}</a>
        </nav>
        <h1 class="product-banner-title">{{ doc.name }}</h1>
    </div>
</section>
{% endblock %}
{% block page_content %}
<style>
    .order-page {
        background-color: #f2f2f2;
        color: white;
        font-family: 'Segoe UI', sans-serif;
		border-radius: 8px;
		padding: 20px;
    }
    .header-bar {
        display: inline;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: #ffffff;
		border-radius: 8px;
		color: black;
    }
    .header-left .btn-orange {
        background-color: orange;
        color: white;
        font-weight: bold;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
    }
    .header-right .admin-label {
        color: white;
        font-weight: bold;
        margin-right: 1rem;
    }
    .header-right .btn-orange {
        background-color: orange;
        color: black;
        font-weight: bold;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
    }
    .items-table {
       border-collapse: separate;
        border-spacing: 0;
        border-radius: 12px !important;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
       /* margin-top: 2rem;*/
        background: #000c3f;
        color: white;
        border: 2px solid #ddd;

    }
    .items-table thead {
        border: 1px solid #444;
        font-weight: bold;
    }
	.items-table th {
        padding: 1rem;
        vertical-align: middle;
		background: #590088;
    }
    .items-table td{
        padding: 1rem;
        vertical-align: middle;
		background: #ffffff;
		color: black;
    }
    .items-table tr{
		border-bottom: 1px solid #ddd;
	}
    .item-img {
        width: 100px;
        height: 100px;
        border-radius: 6px;
        margin-right: 1rem;
        object-fit: cover;
    }
    .summary-totals {
        margin-top: 2rem;
        padding: 1rem;
        border-top: 1px solid #555;
        color: black;
        font-size: 1rem;
    }
    .summary-totals div {
		color: black;
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
    }
	.order-taxes {
		color: #000;
		border-radius: 8px;
	}
.payment-section {
  background-color: #1e1b2e;
  color: #ffffff;
  padding: 20px;
  border-radius: 8px;
}
.btn-primary {
  background-color: #6a0dad;
  border-color: #6a0dad;
}
.card-icons i {
  margin-left: 5px;
  font-size: 1.2em;
  color: #ccc;
}
.payment-container {
  display: flex;
  justify-content: space-between;
  background-color: #ffffff;
  color: #000000;
  padding: 20px;
  border-radius: 10px;
  gap: 30px;
  flex-wrap: wrap;
}

.payment-methods, .billing-summary {
  flex: 1;
  min-width: 300px;
}

.balance-input {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

input[type="text"], select {
  padding: 8px;
  border-radius: 5px;
  border: none;
  width: 100%;
}

.apply-btn, .pay-btn {
  background-color: #6a0dad;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 5px;
  cursor: pointer;
}

.method-group {
  margin-top: 20px;
}

.method-group h4 {
  margin-bottom: 10px;
  color: #5b0089;
}

.method-group label {
  display: block;
  margin-bottom: 8px;
}

.bank-select {
  margin-top: 8px;
  width: 100%;
}

.billing-summary h4 {
  margin-bottom: 15px;
  color: #c3a6ff;
}

.item-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
}

.disabled label {
  color: #888;
}
.card {
  background-color: #1e1b2e;
  color: #fff;
}

.badge {
  background-color: transparent;
  border-color: #6a0dad;
  color: #6a0dad;
}

.btn:hover {
  background-color: #4fd1c5 !important;
}


</style>

<div class="order-page row mb-5">
  <div class="d-grid col-md-8 ml-4 col-12">
     {% if "Corporate Buyer" not in roles %}
  <div class="payment-container rounded shadow mb-4">
  <!-- Left: Payment Methods -->
  <div class="payment-methods">
    <div class="balance-section">
      <h2 class ="text-purple" style="font-size: 18px;font-weight: 700;">Payment method</h2>
      <label for="balance-code">Your available balance</label>
      <div class="balance-input">
        <input type="text" id="balance-code" style="border: 1px solid #f2f2f2;"placeholder="Enter code">
        <button class="apply-btn">Apply</button>
      </div>
    </div>

    <div class="method-group">
      <h4 style="font-size:16px; font-weight:600;">UPI</h4>
      <label><input type="radio" name="payment" value="amazon_upi"> Amazon Pay UPI</label>
      <label><input type="radio" name="payment" value="bob_upi"> Bank of Baroda *5771</label>
    </div>

    <div class="method-group">
      <h4 style="font-size:16px; font-weight:600;">Other Payment Methods</h4>
      <label><input type="radio" name="payment" value="card"> Credit/Debit Card</label>
      <label><input type="radio" name="payment" value="netbanking"> Net Banking</label>
      <!--<select class="bank-select mb-2">
        <option disabled selected>Choose an Option</option>
        <option>SBI</option>
        <option>HDFC</option>
        <option>ICICI</option>
      </select>-->
      <label><input type="radio" name="payment" value="other_upi"> Other UPI Apps</label>
      <label><input type="radio" name="payment" value="emi"> EMI</label>
    </div>

    <div class="method-group disabled">
      <label><input type="radio" disabled> Cash on Delivery / Pay on Delivery (Unavailable)</label>
    </div>
  </div>
  
</div>
{% endif %}

    <table class="items-table rounded shadow ">
        <thead class="rounded">
            <tr>
                <th class="text-start ">Item</th>
                <th class="text-center px-0">Quantity</th>
                <th class="text-center px-0">Rate</th>
                <th class="text-end">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for d in doc.items %}
            <tr>
                <td style="display: flex; align-items: center;">
                    {% set website_item_list = frappe.get_all("Website Item", filters={"item_code": d.item_code}, limit=1) %}
                    {% if website_item_list %}
                        {% set website_item = frappe.get_doc("Website Item", website_item_list[0].name) %}
                        {% if website_item.website_image %}
                            <img src="{{ website_item.website_image }}" class="item-img" alt="{{ d.item_code }}">
                        {% endif %}
                    {% endif %}
                    <div>
                        {{ d.item_name }}<br>
                        <small class="text-black">{{ d.description }}</small>
                    </div>
                </td>
                <td class="text-center px-0">{{ d.get_formatted("qty") }}</td>
                <td class="text-center px-0">{{ d.get_formatted("rate") }}</td>
                <td class="text-end">{{ d.get_formatted("amount") }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
  </div>
     {#<div class="header-bar shadow col-md-3 col-12" style="margin-left: 54px;height: fit-content;">
      <div class="col-md-6 mb-2">
        <div class="badge bg-info text-light p-2 text-uppercase me-2" style="border: 1px solid #590088;
    background: #ffffff !important;
    color: #000000 !important;">
          {{ _(doc.get('indicator_title')) or _(doc.status) or _("Submitted") }}
        </div>
        <div class=" mt-2 small">
          {{ frappe.utils.format_date(doc.transaction_date, "medium") }}
          {% if doc.valid_till %}
            • {{ _("Valid Till") }}: {{ frappe.utils.format_date(doc.valid_till, "medium") }}
          {% endif %}
        </div>
      </div>
       <!-- Taxes & Payment Summary -->
        <div class="mb-4">
            {% include "webshop/templates/includes/order/order_taxes.html" %}
        </div>
        <div class="col-md-12 text-start">

        <h5 class="mb-0">
          {%- set party_name = doc.supplier_name if doc.doctype in ['Supplier Quotation', 'Purchase Invoice', 'Purchase Order'] else doc.customer_name -%}
          {{ party_name }}
        </h5>
        {% if doc.contact_display and doc.contact_display != party_name %}
        <div class="text-muted small">{{ doc.contact_display }}</div>
        {% endif %}
        {% if enabled_checkout and (doc.doctype != "Sales Invoice" or doc.outstanding_amount > 0) %}
          <a href="/api/method/erpnext.accounts.doctype.payment_request.payment_request.make_payment_request?dn={{ doc.name }}&dt={{ doc.doctype }}&submit_doc=1&order_type=Shopping Cart" class="btn btn-sm btn-success mt-2 w-100" style="border: 1px solid aqua;
    background: aqua !important;
    color: #fff !important;">
            <b>{{ _("Pay") }} {{ doc.get_formatted("grand_total") }}</b>
          </a>
        {% endif %}
      </div>
    </div>#}
   <div class="card shadow-lg border-0 rounded-4 col-md-3 col-12 mx-auto" 
     style="    height: fit-content;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef); 
            color: #1a1a1a; 
            min-height: fit-content;
            margin-left: 54px;
            transition: all 0.3s ease;
     ">

  <div class="card-body p-4">

    <!-- Status Badge & Date -->
    <div class="mb-3">
      <span class="badge border border-primary text-primary fw-semibold text-uppercase px-3 py-1 rounded-pill" 
            style="background: #fff; color: #6f42c1; border-color: #6f42c1;">
        {{ _(doc.get('indicator_title')) or _(doc.status) or _("Submitted") }}
      </span>
      <p class="mt-3 small text-muted">
        {{ frappe.utils.format_date(doc.transaction_date, "medium") }}
        {% if doc.valid_till %}
          • {{ _("Valid Till") }}: {{ frappe.utils.format_date(doc.valid_till, "medium") }}
        {% endif %}
      </p>
    </div>

    <!-- Grand Total -->
    <div class="mb-4">
      <p class="text-sm fw-medium text-secondary mb-1">{{ _("Grand Total") }}</p>
      <h3 class="fw-bold text-dark mb-0">{{ doc.get_formatted("grand_total") }}</h3>
    </div>

    <!-- Party Name -->
    <div class="mb-3">
      <h5 class="fw-semibold mb-0">
        {%- set party_name = doc.supplier_name if doc.doctype in ['Supplier Quotation', 'Purchase Invoice', 'Purchase Order'] else doc.customer_name -%}
        {{ party_name }}
      </h5>
      {% if doc.contact_display and doc.contact_display != party_name %}
        <div class="text-muted small">{{ doc.contact_display }}</div>
      {% endif %}
    </div>

    <!-- Taxes & Payment Summary -->
    <!--<div class="mb-4">
      {% include "webshop/templates/includes/order/order_taxes.html" %}
    </div>-->

    <!-- Pay Button -->
    {% if enabled_checkout and (doc.doctype != "Sales Invoice" or doc.outstanding_amount > 0) and ("Corporate Buyer" not in roles)%}
      <a href="/api/method/erpnext.accounts.doctype.payment_request.payment_request.make_payment_request?dn={{ doc.name }}&dt={{ doc.doctype }}&submit_doc=1&order_type=Shopping Cart"
         class="btn w-100 fw-bold text-white"
         style="background: linear-gradient(90deg, #6f42c1, #9b59b6); border: none;">
         {{ _("Pay") }} {{ doc.get_formatted("grand_total") }}
      </a>
    {% endif %}

  </div>
</div>


    <!-- Loyalty Points -->
    {% if enabled_checkout and ((doc.doctype=="Sales Order" and doc.per_billed <= 0) or (doc.doctype=="Sales Invoice" and doc.outstanding_amount> 0)) %}
    
        {% if available_loyalty_points %}
		<div class="card shadow-sm mb-4 p-3">
        <h6 class="fw-bold mb-2">{{ _("Redeem Loyalty Points") }}</h6>
        <div class="d-flex align-items-center gap-3">
            <input class="form-control w-auto" type="number" min="0" max="{{ available_loyalty_points }}" id="loyalty-point-to-redeem">
            <small class="text-muted">Available Points: {{ available_loyalty_points }}</small>
        </div>
		   </div>
        {% endif %}
 
    {% endif %}

    <!-- Attachments -->
    {% if attachments %}
    <div class="card shadow-sm mb-4 p-3">
        <h6 class="fw-bold mb-2">{{ _("Attachments") }}</h6>
        <ul class="list-unstyled mb-0">
            {% for attachment in attachments %}
            <li><a href="{{ attachment.file_url }}" target="_blank">{{ attachment.file_name }}</a></li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Terms & Conditions -->
    {% if doc.terms %}
		<div class="card shadow-sm mb-4 p-3 text-muted">
			<h6 class="fw-bold mb-2">{{ _("Terms & Conditions") }}</h6>
			<p>{{ doc.terms }}</p>
		</div>
    {% endif %}

</div>

<style>
.order-item-row:hover {
    background-color: #f9f9f9;
}
.order-image img {
    max-width: 60px;
    max-height: 60px;
    object-fit: cover;
    border-radius: 4px;
}
</style>
{% endblock %}

{% block script %}
	<script> {% include "templates/pages/order.js" %}</script>
	<script>
		window.doc_info = {
			customer: '{{doc.customer}}',
			doctype: '{{ doc.doctype }}',
			doctype_name: '{{ doc.name }}',
			grand_total: '{{ doc.grand_total }}',
			currency: '{{ doc.currency }}'
		}
	</script>
	<script>
	document.addEventListener("DOMContentLoaded", function () {
		const element = document.querySelector('.container');
		const element2 = document.querySelector('.container .my-4');
		const breadcrumbs = document.querySelector('.page-breadcrumbs');
		const header = document.querySelector('.page-header');
		const pageheader = document.querySelector('.page-header-wrapper');

		if (pageheader){
			pageheader.classList.add('p-0');
		}
		if (header){
			header.style.width = "100%";
		}
		if (breadcrumbs) {
			breadcrumbs.style.display = "none";
		}
		if (element) {
			element.classList.remove('container');
			element.classList.remove('my-4');
			}
		if (element2) {
		element2.classList.remove('container');
		element2.classList.add('container-fluid');
		element2.classList.add('p-0');
		element2.classList.remove('my-4');
		element.classList.add('bg-white');
		}
     }
  )
  

</script>
{% endblock %} 
