{% extends "templates/web.html" %}

{% block page_content %}

<style>
    :root {
        --primary: #d59b22;
        --light-gray: #f7f7f7;
        --border: #e6e6e6;
    }

    .profile-wrapper {
        max-width: 950px;
        margin: auto;
    }

    .profile-card {
        background: #fff;
        padding: 35px;
        border-radius: 14px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border: 1px solid var(--border);
    }

    .page-title {
        font-size: 30px;
        font-weight: 700;
        color: #333;
        margin-bottom: 25px;
    }

    .section-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 10px;
        border-left: 4px solid var(--primary);
        padding-left: 10px;
    }

    .section-divider {
        height: 1px;
        background: var(--primary);
        opacity: 0.2;
        margin: 10px 0 20px 0;
    }

    .form-control {
        height: 42px !important;
        border-radius: 6px;
        border: 1px solid var(--border);
    }

    .btn-primary-custom {
        background: var(--primary);
        border: none;
        padding: 10px 20px;
        color: #fff;
        border-radius: 6px;
        font-weight: 600;
    }

    /* Address styling */
    .address-container {
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 18px;
        background: #fff;
        transition: all 0.25s ease;
    }

    .address-container:hover {
        box-shadow: 0 4px 14px rgba(0,0,0,0.08);
        border-color: var(--primary);
        transform: translateY(-2px);
    }

    .address-card h6 {
        font-size: 17px;
        font-weight: 700;
    }

    .address-card p {
        margin-top: 8px;
        line-height: 1.5;
        font-size: 14px;
        color: #666;
    }

    .btn-delete-address {
        padding: 6px 12px;
        font-size: 13px;
        border-radius: 5px;
    }

    .shipping-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 40px;
    }

    .btn-add-address {
        border: 1px solid var(--primary);
        color: var(--primary);
        padding: 8px 14px;
        font-weight: 600;
        border-radius: 6px;
    }

    .btn-add-address:hover {
        background: var(--primary);
        color: #fff;
    }

</style>

<div class="profile-wrapper mt-5">

    <div class="profile-card">

        <h2 class="page-title">{{ user_doc.full_name }}</h2>

        <!-- PROFILE FORM -->
        <h4 class="section-title">Profile Information</h4>
        <div class="section-divider"></div>

        <form id="profile-form">

            <div class="row">
                <div class="col-sm-6 mb-3">
                    <label class="fw-semibold">First Name *</label>
                    <input type="text" name="first_name" class="form-control"
                        value="{{ user_doc.first_name }}">
                </div>

                <div class="col-sm-6 mb-3">
                    <label class="fw-semibold">Middle Name</label>
                    <input type="text" name="middle_name" class="form-control"
                        value="{{ user_doc.middle_name or '' }}">
                </div>

                <div class="col-sm-6 mb-3">
                    <label class="fw-semibold">Last Name</label>
                    <input type="text" name="last_name" class="form-control"
                        value="{{ user_doc.last_name or '' }}">
                </div>

                <div class="col-sm-6 mb-3">
                    <label class="fw-semibold">Phone</label>
                    <input type="text" name="phone" class="form-control"
                        value="{{ user_doc.phone or '' }}">
                </div>
            </div>

            <button type="button" id="save-profile-btn" class="btn-primary-custom mt-3">
                Save Changes
            </button>
        </form>


        <!-- SHIPPING ADDRESSES -->
        <div class="shipping-header">
            <h4 class="section-title">Shipping Addresses</h4>
            <a class="btn-add-address" href="/address/new">
                + Add Address
            </a>
        </div>

        <div class="section-divider"></div>

        <div id="shipping-address-list" class="mt-3">

            {% if shipping_addresses %}
                {% for address in shipping_addresses %}

                    <div class="address-container" data-address-name="{{ address.name }}">

                        <div class="address-card">
                            <h6>{{ address.address_title }}</h6>

                            <p style="white-space:pre-line;">
                                {{ address.display }}
                            </p>

                            <a href="/address/{{ address.name }}" class="fw-semibold text-decoration-none">
                                View Details
                            </a>
                        </div>

                    </div>

                {% endfor %}
            {% else %}
                <p class="text-muted mt-3">No shipping addresses added yet.</p>
            {% endif %}

        </div>

    </div>
</div>


<!-- JS -->
<script>
    frappe.ready(function () {

        // Save profile
        $("#save-profile-btn").click(function () {
            frappe.call({
                method: "webshop.webshop.api.update_profile",
                args: {
                    user: "{{ user_doc.name }}",
                    first_name: $("input[name='first_name']").val(),
                    middle_name: $("input[name='middle_name']").val(),
                    last_name: $("input[name='last_name']").val(),
                    phone: $("input[name='phone']").val(),
                },
                callback: function (r) {
                    frappe.msgprint(r.message || "Profile Updated Successfully");
                }
            });
        });

        // Delete address
        $(document).on("click", ".btn-delete-address", function () {
            const name = $(this).data("name");

            frappe.confirm("Delete this address?", () => {
                frappe.call({
                    method: "frappe.client.delete",
                    args: { doctype: "Address", name },
                    callback: function () {
                        window.location.reload();
                    }
                });
            });
        });

    });
</script>

{% endblock %}
